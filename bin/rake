#!/usr/bin/env node

var rake = require('..'),
    program = require('commander'),
    fs = require('fs'),
    path = require('path'),
    expand = function (file) {
    	return path.join(process.cwd(), file)
    },
    pkg = require(expand('package.json'))

program
	.version(require('../package.json').version)
	.usage('-c main.css -j app.js -o bundle')
	.option('-c, --css [file]', 'css', pkg.style)
	.option('-j, --js [file]', 'js', pkg.main)
	.option('-s, --shim [file]', 'shim', pkg.shim)
	.option('-o, --output [name]', 'output', 'bundle')
	.parse(process.argv)

if (program.js) {
	var options = {
	    	entry: expand(program.js)
	    }

	if (program.shim) {
		options.shim = function () {
			var shim = typeof program.shim === 'string' 
			         ? require(expand(program.shim))
			         : program.shim

			for (var i in shim) {
				shim[i].path = expand(shim[i].path)
			}

			return shim
		}()
	}

	rake.js(options)
		.then(function (src) {
			fs.writeFile(program.output + '.js', src)
		}).catch(function (err) {
			console.error(err.stack)
		})
}

if (program.css) {
	rake.css({
			entry: expand(program.css)
		})
		.then(function (src) {
			fs.writeFile(program.output + '.css', src)
		}).catch(function (err) {
			console.error(err.stack)
		})
}





